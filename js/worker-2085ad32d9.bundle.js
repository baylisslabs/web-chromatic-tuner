!function(){function t(e,r,i){function s(a,o){if(!r[a]){if(!e[a]){var u="function"==typeof require&&require;if(!o&&u)return u(a,!0);if(n)return n(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var c=r[a]={exports:{}};e[a][0].call(c.exports,function(t){return s(e[a][1][t]||t)},c,c.exports,t,e,r,i)}return r[a].exports}for(var n="function"==typeof require&&require,a=0;a<i.length;a++)s(i[a]);return s}return t}()({1:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PitchDetector=r.PitchDetectorParams=void 0;var i=t("../numerics/discreteData2"),s=t("../numerics/point2"),n=t("../numerics/leastSquares"),a=function(){function t(){this._limit_data_len=3600,this._first_lag=10,this._last_lag=1800,this._step_lag=2,this._refine_lag_window=8,this._refine_step_lag=1,this._global_thresh=.2,this._local_thresh=.05,this._squelch_open=10,this._squelch_close=2}return t}();r.PitchDetectorParams=a;var o=function(){function t(t,e){this._params=t,this._resultHandler=e,this._resultSeq=0,this._squelch=!1,this._min_avg_pwr2=Number.MAX_VALUE,this._rmsSquared=0}return t.prototype.processLinearPcm=function(t,e){if(t.length>=this._params._last_lag&&t.length>=this._params._limit_data_len){t=t.slice(0,this._params._limit_data_len);var r=0,s=void 0,n=performance.now(),a=this.normalised_square_differences(this._params._first_lag,this._params._last_lag,this._params._step_lag,t),o=(0,i.minimaBetweenZeroCrossing)(a,this._params._global_thresh,1),u=this.bestMinimum(o,this._params._local_thresh);if(u){var h=Math.max(1,u.x-this._params._refine_lag_window/2),c=Math.min(t.length/2-1,h+this._params._refine_lag_window-1),_=this.normalised_square_differences(h,c,this._params._refine_step_lag,t);if(s=this.refineByLeastSquares(_),u=s?s.vertex():void 0){var l=u.x;l>=this._params._first_lag&&l<=this._params._last_lag&&(r=e/l)}}var f={seq:this._resultSeq++,f_0_Hz:r,q_Hz:void 0,samplingRate:e,selectedMinima:u,leastSquaresParabola:s,processingTimeMs:performance.now()-n,timeStamp:Date.now(),squelch:this._squelch,rmsSquared:this._rmsSquared};this._resultHandler(f)}},t.prototype.refineByLeastSquares=function(t){return new n.LeastSquares(t).parabola2()},t.prototype.bestMinimum=function(t,e){if(0!=t.length){for(var r=t.get(0),i=0;i<t.length;++i){var s=t.get(i);s.y<r.y&&(r=s)}for(var i=0;i<t.length;++i){var s=t.get(i);if(s.x>=r.x)break;if(s.y-e<r.y){r=s;break}}return r}return null},t.prototype.normalised_square_differences=function(t,e,r,i){var n=i.length,a=new Float32Array(n),o=Math.floor((e-t+1)/r),u=new s.Point2Vector(o);if(this.cumulative_squares(a,i,n),this.update_squelch(a[a.length-1]/n))for(var h=t,c=0;c<o;c++)u.pushxy(h,this.normalised_square_difference_single(h,i,i,a,n)),h+=r;return u},t.prototype.cumulative_squares=function(t,e,r){for(var i=0,s=0;s<r;++s)i=t[s]=e[s]*e[s]+i},t.prototype.normalised_square_difference_single=function(t,e,r,i,s){for(var n=s-t,a=i[n-1]+i[s-1]-i[t-1],o=0,u=0,h=t;u<n;++u,++h)o+=e[u]*r[h];return(-o-o)/a+1},t.prototype.update_squelch=function(t){return this._rmsSquared=t,t<this._min_avg_pwr2&&(this._min_avg_pwr2=t),this._squelch&&t<this._min_avg_pwr2*this._params._squelch_close?this._squelch=!1:!this._squelch&&t>this._min_avg_pwr2*this._params._squelch_open&&(this._squelch=!0),this._squelch},t}();r.PitchDetector=o},{"../numerics/discreteData2":3,"../numerics/leastSquares":4,"../numerics/point2":6}],2:[function(t,e,r){"use strict";function i(t){for(var e=new Array(t.length),r=0;r<t.length;++r)e[r]=t[r]*t[r];return e}function s(t){for(var e=0,r=0;r<t.length;++r)e+=t[r];return e}function n(t){for(var e=new Array(t.length),r=0;r<t.length;++r)e[r]=t[r]*t[r]*t[r];return e}function a(t){for(var e=new Array(t.length),r=0;r<t.length;++r){var i=t[r]*t[r];e[r]=i*i}return e}function o(t,e){for(var r=new Array(t.length),i=0;i<t.length;++i)r[i]=t[i]*e[i];return r}function u(t){for(var e=0,r=0;r<t.length;++r)e+=t[r]*t[r]*t[r];return e}function h(t){for(var e=0,r=0;r<t.length;++r){var i=t[r]*t[r];e+=i*i}return e}function c(t,e){for(var r=0,i=0;i<t.length;++i)r+=t[i]*e[i];return r}Object.defineProperty(r,"__esModule",{value:!0}),r.productSum=r.to4thSum=r.cubeSum=r.product=r.to4th=r.cube=r.sum=r.square=void 0,r.square=i,r.sum=s,r.cube=n,r.to4th=a,r.product=o,r.cubeSum=u,r.to4thSum=h,r.productSum=c},{}],3:[function(t,e,r){"use strict";function i(t,e,r){for(var i,n,a,o=new s.Point2Vector(t.length),u=t.length?t.get(0):void 0,h=1;h<t.length;++h){var c=t.get(h);c.y<u.y?(i=c,n=void 0):c.y>u.y&&(n=u),n&&i&&(i.y<e&&(!a||a.y>i.y)&&(a={x:(i.x+n.x)/2,y:i.y}),i=void 0,n=void 0),c.y>=r&&(a&&o.push(a),a=void 0),u=c}return a&&o.push(a),o}Object.defineProperty(r,"__esModule",{value:!0}),r.minimaBetweenZeroCrossing=void 0;var s=t("./point2");r.minimaBetweenZeroCrossing=i},{"./point2":6}],4:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LeastSquares=void 0;var i=t("./quadratic"),s=t("./matrix"),n=t("./arrayExtensions"),a=function(){function t(t){this._points=t}return t.prototype.parabola2=function(){var t=this._points.length,e=this._points.xvals(),r=this._points.yvals(),a=n.square(e),o=n.sum(e),u=n.sum(a),h=n.cubeSum(e),c=n.to4thSum(e),_=new s.Matrix([[t,o,u,n.sum(r)],[o,u,h,n.productSum(r,e)],[u,h,c,n.productSum(r,a)]]);if(_.doGaussJordan())return i.Quadratic.fromVector(_.col(3))},t}();r.LeastSquares=a},{"./arrayExtensions":2,"./matrix":5,"./quadratic":7}],5:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Matrix=void 0;var i=t("./vector"),s=t("./reduce"),n=function(){function t(t){this._rows=t}return t.prototype.swapRows=function(t,e){if(t!=e){var r=this._rows[t];this._rows[t]=this._rows[e],this._rows[e]=r}},t.prototype.row=function(t){return this._rows[t]},t.prototype.col=function(t){for(var e=new Array(this._rows.length),r=0;r<e.length;++r)e[r]=this._rows[r][t];return e},t.prototype.doGaussianElimination=function(){for(var t=this,e=this._rows.length,r=this,n=0;n<e;++n){var a=function(n){var a=(0,s.argMax)(n,e,function(e){return Math.abs(t._rows[e][n])});r.swapRows(n,a);var o=r._rows[n][n];if(0==o)return{value:!1};(0,i.scale)(r._rows[n],1/o);for(var u=n+1;u<r._rows.length;++u)(0,i.subtractWithScale)(r._rows[u],r._rows[n],r._rows[u][n])}(n);if("object"==typeof a)return a.value}return!0},t.prototype.doGaussJordan=function(){if(this.doGaussianElimination()){for(var t=this._rows.length-1;t>0;--t)for(var e=t-1;e>=0;--e)(0,i.subtractWithScale)(this._rows[e],this._rows[t],this._rows[e][t]);return!0}return!1},t}();r.Matrix=n},{"./reduce":8,"./vector":9}],6:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Point2Vector=void 0;var i=function(){function t(t){var e=this;this.xvals=function(){return e.x_values.slice(0,e.length)},this.yvals=function(){return e.y_values.slice(0,e.length)},this.length=0,this.x_values=new Array(t),this.y_values=new Array(t)}return t.prototype.pushxy=function(t,e){this.x_values[this.length]=t,this.y_values[this.length]=e,this.length++},t.prototype.push=function(t){this.x_values[this.length]=t.x,this.y_values[this.length]=t.y,this.length++},t.prototype.get=function(t){return{x:this.x_values[t],y:this.y_values[t]}},t}();r.Point2Vector=i},{}],7:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Quadratic=void 0;var i=function(){function t(t,e,r){this.a=t,this.b=e,this.c=r}return t.fromVector=function(e){return new t(e[2],e[1],e[0])},t.prototype.discriminant=function(){return this.b*this.b-4*this.a*this.c},t.prototype.axisOfSym=function(){if(0!=this.a)return-this.b/(2*this.a)},t.prototype.vertex=function(){if(0!=this.a)return{x:-this.b/(2*this.a),y:(this.b*this.b-4*this.a*this.c)/(4*this.a)}},t}();r.Quadratic=i},{}],8:[function(t,e,r){"use strict";function i(t,e,r){for(var i=t,s=r(t),n=t+1;n<e;++n){var a=r(n);a>s&&(s=a,i=n)}return i}Object.defineProperty(r,"__esModule",{value:!0}),r.argMax=void 0,r.argMax=i},{}],9:[function(t,e,r){"use strict";function i(t,e){for(var r=0;r<t.length;++r)t[r]*=e}function s(t,e){for(var r=0;r<t.length;++r)t[r]-=e[r]}function n(t,e,r){for(var i=0;i<t.length;++i)t[i]-=e[i]*r}Object.defineProperty(r,"__esModule",{value:!0}),r.subtractWithScale=r.subtract=r.scale=void 0,r.scale=i,r.subtract=s,r.subtractWithScale=n},{}],10:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../iso/audio/pitchDetector"),s=t("../../iso/audio/pitchDetector"),n=new s.PitchDetectorParams,a=new i.PitchDetector(n,function(t){postMessage(t)});onmessage=function(t){a.processLinearPcm(t.data.dataArray,t.data.sampleRate)}},{"../../iso/audio/pitchDetector":1}]},{},[10]);